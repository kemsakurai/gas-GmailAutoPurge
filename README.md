# GmailAutoPurge

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Gmailã®æ¤œç´¢çµæœã‹ã‚‰è‡ªå‹•ã§ãƒ¡ãƒ¼ãƒ«ã‚’å‰Šé™¤ã™ã‚‹Google Apps Scriptã§ã™ã€‚Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§å‰Šé™¤ãƒ«ãƒ¼ãƒ«ï¼ˆãƒ©ãƒ™ãƒ«ã€ä¿æœ‰æœŸé–“ã€æ¡ä»¶ãªã©ï¼‰ã‚’ç®¡ç†ã—ã€å®šæœŸçš„ã«Gmailã‚’è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã§ãã¾ã™ã€‚

## ç‰¹å¾´

- **ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ UI** - Config ã‚·ãƒ¼ãƒˆã§ãƒ«ãƒ¼ãƒ«ã‚’ç›´æ¥ç·¨é›†
- **ãƒãƒƒãƒå‡¦ç†** - æœ€å¤§10ä»¶/å®Ÿè¡Œã§å®Ÿè¡Œæ™‚é–“åˆ¶é™ã‚’å›é¿
- **ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†** - ä¸­æ–­ãƒ»å†é–‹ã«å¯¾å¿œã€‚å¤§é‡ãƒ«ãƒ¼ãƒ«ã§ã‚‚å®‰å…¨ã«å‡¦ç†
- **æ¡ä»¶ä»˜ãå‰Šé™¤** - ã‚¹ã‚¿ãƒ¼ä»˜ãã€é‡è¦ãƒãƒ¼ã‚¯ä»˜ããƒ¡ãƒ¼ãƒ«ä¿è­·
- **Gmailæ¤œç´¢æœ€é©åŒ–** - Configè¨­å®šå€¤ã‹ã‚‰ã‚¯ã‚¨ãƒªã‚’å‹•çš„ã«çµ„ã¿ç«‹ã¦ã€APIåŠ¹ç‡ã‚’å‘ä¸Š
- **è©³ç´°ãªãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒ­ã‚°** - å‡¦ç†é€²æ—ã‚’ãƒ­ã‚®ãƒ³ã‚°ã€‚å®Ÿè¡Œæ™‚é–“è­¦å‘Šæ©Ÿèƒ½ä»˜ã
- **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ** - åˆ†å˜ä½ï½æœˆå˜ä½ã®å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```console
git clone https://github.com/kemsakurai/gas-GmailAutoPurge.git
cd gas-GmailAutoPurge
npm install -g clasp
npm install
```

## ãƒ“ãƒ«ãƒ‰ & ãƒ‡ãƒ—ãƒ­ã‚¤

```console
sh build.sh && clasp push
```

## ä½¿ç”¨æ–¹æ³•

1. **åˆæœŸåŒ–**: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ > gas-GmailAutoPurge > åˆæœŸè¨­å®š > è¨­å®šã‚·ãƒ¼ãƒˆä½œæˆ
2. **ãƒ«ãƒ¼ãƒ«å®šç¾©**: Config ã‚·ãƒ¼ãƒˆã«å‰Šé™¤ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ 
3. **å®Ÿè¡Œ**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ > gas-GmailAutoPurge > ãƒ¡ãƒ¼ãƒ«ã‚’å‰Šé™¤ã™ã‚‹
4. **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ«è¨­å®š**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ > gas-GmailAutoPurge > ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

## Config ã‚·ãƒ¼ãƒˆæ§‹æˆ

| åˆ— | é …ç›®å | å‹ | èª¬æ˜ |
|---|---|---|---|
| A | Notes | æ–‡å­—åˆ— | ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜ |
| B | label | æ–‡å­—åˆ— | Gmailãƒ©ãƒ™ãƒ«å |
| C | Retention period | æ•°å€¤ | å‰Šé™¤å¯¾è±¡ã®æ—¥æ•°ï¼ˆâ—‹æ—¥ä»¥ä¸Šå‰ï¼‰ |
| D | Leave starred email | çœŸå½å€¤ | TRUE=ã‚¹ã‚¿ãƒ¼ä»˜ããƒ¡ãƒ¼ãƒ«ä¿æŒ |
| E | Leave important email | çœŸå½å€¤ | TRUE=é‡è¦ãƒãƒ¼ã‚¯ä»˜ããƒ¡ãƒ¼ãƒ«ä¿æŒ |

## æŠ€è¡“ä»•æ§˜

- **è¨€èª**: TypeScript (Google Apps Script)
- **ãƒãƒƒãƒã‚µã‚¤ã‚º**: æœ€å¤§10ä»¶ãƒ«ãƒ¼ãƒ«/å®Ÿè¡Œ
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Properties Serviceï¼ˆãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä¿å­˜ï¼‰
- **è‡ªå‹•å®Ÿè¡Œ**: ScriptApp.newTrigger() ã§è¨­å®š

## Gmailæ¤œç´¢æœ€é©åŒ–

Config ã‚·ãƒ¼ãƒˆã®æ¡ä»¶è¨­å®šã‹ã‚‰ Gmailæ¤œç´¢ã‚¯ã‚¨ãƒªã‚’å‹•çš„ã«çµ„ã¿ç«‹ã¦ã¾ã™ï¼š

```
åŸºæœ¬ã‚¯ã‚¨ãƒª: label:<label> before:<YYYY-MM-DD>
  + Leave starred email = TRUE â†’ -is:starred ã‚’è¿½åŠ 
  + Leave important email = TRUE â†’ -is:important ã‚’è¿½åŠ 
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚¹ã‚¿ãƒ¼ä»˜ããƒ»é‡è¦ãƒãƒ¼ã‚¯ä»˜ããƒ¡ãƒ¼ãƒ«é™¤å¤–ã‚’ã‚¯ã‚¨ãƒªãƒ¬ãƒ™ãƒ«ã§å®Ÿç¾
- ä¸è¦ãªãƒ¡ãƒ¼ãƒ«å–å¾—ã‚’å‰Šæ¸› â†’ APIåŠ¹ç‡å‘ä¸Š
- å®Ÿè¡Œæ™‚é–“çŸ­ç¸®

**ä¾‹**:
- Config: label="Inbox", days=30, Leave starred=TRUE, Leave important=FALSE
- ã‚¯ã‚¨ãƒª: `label:Inbox before:2024-XX-XX -is:starred`

## ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒ­ã‚°ã¨ãƒ‡ãƒãƒƒã‚°

`purgeEmail()` å®Ÿè¡Œæ™‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆCtrl+Shift+Jï¼‰ã¾ãŸã¯ GAS IDE ã®å®Ÿè¡Œãƒ­ã‚°ã«è©³ç´°æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
ğŸ“Š Batch Info: Processing rows 2-11 / 50 total rows
ğŸ“¦ Batch size: 10 rules
ğŸ”„ Row 2: Starting rule processing...
ğŸ“ Row 2: Notes="Old promotional emails"
ğŸ” Row 2: Query="label:Promotions before:2024-01-15 -is:starred"
âš™ï¸  Row 2: Leave starred=true, Leave important=false
âœ… Row 2: Found 245 threads (search took 1023ms)
ğŸ—‘ï¸  Row 2: Deleted 240 messages
â­ Row 2: Skipped 5 starred messages
â±ï¸  Row 2: Completed in 3421ms
...

ğŸ“Š Execution Summary
âœ… Processed 10 rules
ğŸ“§ Processed 2450 threads
ğŸ—‘ï¸  Deleted 2400 messages
â±ï¸  Total execution time: 35s (35234ms)
âš¡ Average per rule: 3523ms
ğŸ’¾ Checkpoint updated. Next batch will start from row 12
```

**å‡ºåŠ›å†…å®¹**:
- ğŸ“Š **Batch Info**: å‡¦ç†ç¯„å›²ï¼ˆè¡Œç•ªå·ã€ç·è¡Œæ•°ï¼‰
- ğŸ” **Query**: å®Ÿéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ Gmailæ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆæœ€é©åŒ–å¾Œï¼‰
- âœ… **Found**: æ¤œç´¢çµæœï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã€æ¤œç´¢æ™‚é–“ï¼‰
- ğŸ—‘ï¸ **Deleted**: å‰Šé™¤ãƒ¡ãƒ¼ãƒ«æ•°ã€ã‚¹ã‚­ãƒƒãƒ—ã—ãŸç†ç”±åˆ¥é›†è¨ˆ
- â±ï¸ **å®Ÿè¡Œæ™‚é–“**: ãƒ«ãƒ¼ãƒ«åˆ¥ãƒ»å…¨ä½“ãƒ»å¹³å‡å®Ÿè¡Œæ™‚é–“
- âš ï¸ **è­¦å‘Š**: 5åˆ†è¶…éæ™‚ã«å®Ÿè¡Œæ™‚é–“è­¦å‘Šå‡ºåŠ›

## ãƒ†ã‚¹ãƒˆ

```console
npm run test
```

ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
- `convertCellValue2Boolean`: çœŸå½å€¤å¤‰æ›(11ä»¶)
- `buildGmailSearchQuery`: Gmailæ¤œç´¢ã‚¯ã‚¨ãƒªçµ„ã¿ç«‹ã¦(12ä»¶)
- `MAX_BATCH_SIZE`: ãƒãƒƒãƒã‚µã‚¤ã‚ºå®šæ•°æ¤œè¨¼(3ä»¶)
- **ç­‰**

**æ³¨**: Properties Serviceï¼ˆãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†ï¼‰ã®ãƒ†ã‚¹ãƒˆã¯ GAS ç’°å¢ƒã§ã®å®Ÿè¡ŒãŒå¿…è¦ã§ã™ã€‚

è©³ç´°ã¯ `.github/copilot-instructions.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
